<html>
  <head>
    <title>
      Spectacled Porpoise
    </title>
  </head>
  <body>
  </body>

<script id="physics-vs" type="x-shader/x-vertex">
  precision mediump float;
  precision mediump int;

  attribute float aParticleIndex;
  attribute vec2 aVertexIndex;

  uniform float uGridSize;
  uniform vec2 uViewportSize;

  varying float vIndex;
  varying vec2 vCoord;

  vec2 getUVFromIndex(float particleNumber) {
    float interval = 1.0/uGridSize;
    vec2 uv;
    uv.x = interval * mod(particleNumber, uGridSize);
    uv.y = interval * floor(particleNumber/uGridSize);
    return uv;
  }

  void main(void) {
    vCoord = aVertexIndex;
    vIndex = aParticleIndex;
    gl_Position = vec4(aVertexIndex, 0.0, 1.0);
  }
</script>

<script id="physics-fs" type="x-shader/x-fragment">
  #line 10 100
  precision mediump float;
  precision mediump int;

  uniform sampler2D uParticlePositionData;
  uniform vec2 uViewportSize;
  uniform float uGridSize;

  varying float vIndex;
  varying vec2 vCoord;

  vec2 getUVFromIndex(float particleNumber) {
    float interval = 1.0/uGridSize;
    vec2 uv;
    uv.x = interval * mod(particleNumber, uGridSize);
    uv.y = interval * floor(particleNumber/uGridSize);
    return uv;
  }

  vec4 getPosition() {
    return texture2D(uParticlePositionData, gl_FragCoord.xy/uViewportSize);
  }

  void main(void) {
    vec3 pos = getPosition().xyz;
    vec3 dir = cross(vec3(0.0, 0.0, 1.0), pos);
    gl_FragColor = vec4(pos, 1.0) + 0.01*vec4(dir, 1.0);
  }
</script>

<script id="render-vs" type="x-shader/x-vertex">
  precision mediump float;
  precision mediump int;

  attribute float aParticleIndex;

  uniform float uGridSize;

  uniform sampler2D uParticlePositionData;
  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;

  varying float vCoord;

  vec2 getUVFromIndex(float particleNumber) {
    float interval = 1.0/uGridSize;
    vec2 uv;
    uv.x = interval * mod(particleNumber, uGridSize);
    uv.y = interval * floor(particleNumber/uGridSize);
    return uv;
  }


  void main(void) {
  #line 10 100
    vec2 uv = getUVFromIndex(aParticleIndex);
    vec4 particle = texture2D(uParticlePositionData, uv);
    vCoord = aParticleIndex;
    gl_Position = uPMatrix * uMVMatrix * particle;
    gl_PointSize = 5.0;
  }
</script>

<script id="render-fs" type="x-shader/x-fragment">

  #line 0 10
  precision mediump float;

  uniform sampler2D uParticlePositionData;
  uniform float uGridSize;

  varying float vCoord;

  vec2 getUVFromIndex(float particleNumber) {
    float interval = 1.0/uGridSize;
    vec2 uv;
    uv.x = interval * mod(particleNumber, uGridSize);
    uv.y = interval * floor(particleNumber/uGridSize);
    return uv;
  }

  void main(void) {
    gl_FragColor = texture2D(uParticlePositionData, getUVFromIndex(vCoord));
  }
</script>


<script id="debug-vs" type="x-shader/x-vertex">
  precision mediump float;
  precision mediump int;

  attribute float aParticleIndex;

  uniform float uGridSize;

  uniform sampler2D uParticlePositionData;
  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;

  varying float vCoord;

  vec2 getUVFromIndex(float particleNumber) {
    float interval = 1.0/uGridSize;
    vec2 uv;
    uv.x = interval * mod(particleNumber, uGridSize);
    uv.y = interval * floor(particleNumber/uGridSize);
    return uv;
  }


  void main(void) {
  #line 10 100
    vec2 uv = getUVFromIndex(aParticleIndex);
    vec4 particle = texture2D(uParticlePositionData, uv);
    vCoord = aParticleIndex;
    gl_Position = uPMatrix * uMVMatrix * vec4(uv.x * 0.5, uv.y * 0.5, 0.0, 1.0);
    gl_PointSize = 10.0;
  }
</script>

<script id="debug-fs" type="x-shader/x-fragment">

  #line 0 10
  precision mediump float;

  uniform sampler2D uParticlePositionData;
  uniform float uGridSize;

  varying float vCoord;

  vec2 getUVFromIndex(float particleNumber) {
    float interval = 1.0/uGridSize;
    vec2 uv;
    uv.x = interval * mod(particleNumber, uGridSize);
    uv.y = interval * floor(particleNumber/uGridSize);
    return uv;
  }

  void main(void) {
    gl_FragColor = texture2D(uParticlePositionData, getUVFromIndex(vCoord));
  }
</script>



<script src="js/gl-matrix-min.js"></script>
<script src="js/lightgl.js"></script>
<script src="js/particle.js"></script>
<script src="js/webgl-utils.js"></script>
<script src="js/main.js"></script>
</html>
